{"version":3,"file":"devtools.formatters.helpers.js","sources":["devtools/formatters/helpers.cljs"],"mappings":"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","names":["vec__33245","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","well-known-types","devtools.formatters.helpers/pref","value","actual-count","cljs.core/bounded-count","min-count","obj","v","cljs.core/not","devtools.formatters.helpers/is-js-symbol?","cljs.core.take.cljs$core$IFn$_invoke$arity$2","prefix-limit","cljs.core/str","string","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","prefix","devtools.formatters.helpers/is-prototype?","o","and__3911__auto__","devtools.formatters.helpers/cljs-instance?","cljs.core/contains?","fully-qualified-type-name","devtools.formatters.helpers/fetch-fields-values","fields","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","goog/typeOf","cljs.core.map.cljs$core$IFn$_invoke$arity$2","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","devtools.formatters.helpers/fetch-field-value","devtools.formatters.helpers/abbreviate-long-string","marker","postfix-limit","postfix","temp__5455__auto__","devtools.formatters.helpers/instance-of-a-well-known-type?","args-close-symbol","devtools.formatters.helpers/cljs-value?","devtools.formatters.helpers/expandable?","devtools.formatters.helpers/get-constructor","devtools.formatters.helpers/cljs-type?","devtools.formatters.helpers/cljs-land-value?","render-pref","default-check","devtools.formatters.helpers/directly-printable?","field","cljs.core/munge","devtools.formatters.helpers/get-prototype","devtools.formatters.helpers/has-formatting-protocol?","devtools.formatters.helpers/should-render?","pref-key","or__3922__auto__","cljs.core/PROTOCOL_SENTINEL","cljs.core/native-satisfies?","_e__31502__auto__","e33237","cljs.core/IPrintWithWriter","more-count","cljs.core/fn?","e33241","devtools.format/IDevtoolsFormat","devtools.formatters.helpers/get-more-marker","cljs.core/empty?","f","devtools.formatters.helpers/bool?","devtools.munging/cljs-fn?","devtools.formatters.helpers/wrap-arity","arity","cljs.core/var?","e33243","devtools.protocols/IFormat","constructor-fn","goog/isObject","devtools.formatters.helpers/abbreviated?","template","devtools.formatters.helpers/cljs-function?","ns","name","devtools.prefs/pref","p1__33248#","cljs.core/some","cljs.core/take-last","args-open-symbol","cljs.core/ISeqable","devtools.munging/parse-constructor-info","devtools.formatters.helpers/should-render-instance?","cljs.core/Keyword"],"sourcesContent":["(ns devtools.formatters.helpers\n  (:require-macros [devtools.oops :refer [oget safe-call]])\n  (:require [devtools.prefs :as prefs]\n            [devtools.munging :as munging]\n            [devtools.format :refer [IDevtoolsFormat]]\n            [devtools.protocols :refer [ITemplate IGroup ISurrogate IFormat]]))\n\n(defn pref [v]\n  (if (keyword? v)\n    (recur (prefs/pref v))\n    v))\n\n(defn get-prototype [o]\n  (.-prototype o))\n\n(defn get-constructor [o]\n  (.-constructor o))\n\n; ---------------------------------------------------------------------------------------------------------------------------\n\n(defn is-prototype? [o]\n  (identical? (get-prototype (get-constructor o)) o))\n\n(defn is-js-symbol? [o]\n  (= (goog/typeOf o) \"symbol\"))\n\n(defn cljs-function? [value]\n  (and (not (pref :disable-cljs-fn-formatting))                                                                               ; TODO: this should be deprecated\n       (not (var? value))                                                                                                     ; HACK: vars have IFn protocol and would act as functions TODO: implement custom rendering for vars\n       (munging/cljs-fn? value)))\n\n(defn has-formatting-protocol? [value]\n  (or (safe-call satisfies? false IPrintWithWriter value)\n      (safe-call satisfies? false IDevtoolsFormat value)                                                                      ; legacy\n      (safe-call satisfies? false IFormat value)))\n\n; IRC #clojurescript @ freenode.net on 2015-01-27:\n; [13:40:09] darwin_: Hi, what is the best way to test if I'm handled ClojureScript data value or plain javascript object?\n; [14:04:34] dnolen: there is a very low level thing you can check\n; [14:04:36] dnolen: https://github.com/clojure/clojurescript/blob/c2550c4fdc94178a7957497e2bfde54e5600c457/src/clj/cljs/core.clj#L901\n; [14:05:00] dnolen: this property is unlikely to change - still it's probably not something anything anyone should use w/o a really good reason\n(defn cljs-type? [f]\n  (and (goog/isObject f)                                                                                                      ; see http://stackoverflow.com/a/22482737/84283\n       (not (is-prototype? f))\n       (.-cljs$lang$type f)))\n\n(defn cljs-instance? [value]\n  (and (goog/isObject value)                                                                                                  ; see http://stackoverflow.com/a/22482737/84283\n       (cljs-type? (get-constructor value))))\n\n(defn cljs-land-value? [value]\n  (or (cljs-instance? value)\n      (has-formatting-protocol? value)))                                                                                      ; some raw js types can be extend-protocol to support cljs printing, see issue #21\n\n(defn cljs-value? [value]\n  (and\n    (or (cljs-land-value? value)\n        (cljs-function? value))\n    (not (is-prototype? value))\n    (not (is-js-symbol? value))))\n\n(defn bool? [value]\n  (or (true? value) (false? value)))\n\n(defn instance-of-a-well-known-type? [value]\n  (let [well-known-types (pref :well-known-types)\n        constructor-fn (get-constructor value)\n        [ns name] (munging/parse-constructor-info constructor-fn)\n        fully-qualified-type-name (str ns \"/\" name)]\n    (contains? well-known-types fully-qualified-type-name)))\n\n(defn should-render-instance? [value]\n  (and (cljs-instance? value)\n       (not (instance-of-a-well-known-type? value))))\n\n(defn directly-printable? [value]\n  (or (string? value)\n      (number? value)\n      (bool? value)))\n\n; ---------------------------------------------------------------------------------------------------------------------------\n\n(defn abbreviated? [template]\n  (some #(= (pref :more-marker) %) template))\n\n(defn abbreviate-long-string [string marker prefix-limit postfix-limit]\n  (let [prefix (apply str (take prefix-limit string))\n        postfix (apply str (take-last postfix-limit string))]\n    (str prefix marker postfix)))\n\n(defn get-more-marker [more-count]\n  (str (pref :plus-symbol) more-count (pref :more-symbol)))\n\n(defn wrap-arity [arity]\n  (let [args-open-symbol (pref :args-open-symbol)\n        args-close-symbol (pref :args-close-symbol)]\n    (str args-open-symbol arity args-close-symbol)))\n\n(defn fetch-field-value [obj field]\n  [field (oget obj (munge field))])\n\n(defn fetch-fields-values [obj fields]\n  (map (partial fetch-field-value obj) fields))\n\n(defn expandable? [obj]\n  (if (satisfies? ISeqable obj)\n    (if-let [min-count (pref (if (instance-of-a-well-known-type? obj)\n                               :min-expandable-sequable-count-for-well-known-types\n                               :min-expandable-sequable-count))]\n      (if-not (empty? obj)\n        (let [actual-count (bounded-count min-count obj)]\n          (>= actual-count min-count))))))\n\n(defn should-render? [pref-key value default-check]\n  (if-let [render-pref (pref pref-key)]\n    (cond\n      (true? render-pref) (default-check value)\n      (fn? render-pref) (render-pref value))))\n"]}