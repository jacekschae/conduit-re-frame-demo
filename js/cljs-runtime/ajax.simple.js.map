{"version":3,"file":"ajax.simple.js","sources":["ajax/simple.cljc"],"mappings":"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","names":["ajax.simple/ajax-request","request","api","or__3922__auto__","ajax.simple/new-default-api","var_args","G__41401","ajax.simple/js-handler","js/Error","handler","interceptors","response","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","ajax.simple/process-request","ajax.simple/base-handler","cljs.core/reverse","ajax.simple/normalize-request","ajax.interceptors/request-interceptors","ajax.protocols/-process-request","interceptor","method","goog/net.XhrIo","processed","ajax.simple/process-response","p__41408","map__41409","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","response-format","ajax.interceptors/get-response-format","ajax.formats/detect-response-format","p__41420","map__41421","ajax.simple/raw-ajax-request","cljs.core/Keyword","p1__41419#","cljs.core.update.cljs$core$IFn$_invoke$arity$3","cljs.core.concat.cljs$core$IFn$_invoke$arity$variadic","ajax.simple.js_handler.cljs$core$IFn$_invoke$arity$2","ajax.simple/normalize-method","ajax.util/throw-error","clojure.string/upper-case","cljs.core/name","cljs.core/deref","ajax.simple/default-interceptors","ajax.protocols/-process-response","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","ajax.protocols/-js-ajax-request"],"sourcesContent":["(ns ajax.simple\n    (:require [clojure.string :as str]\n              [ajax.protocols :as pr]\n              [ajax.interceptors :as i]\n              [ajax.formats :as f]\n              [ajax.util :as u]\n              #? (:clj [ajax.apache :as a])\n              #? (:clj [poppea :as p]\n                  :cljs [goog.net.XhrIo :as xhr]))\n    #? (:clj (:import [java.io Closeable])\n        :cljs (:require-macros [poppea :as p])))\n\n(defn normalize-method [method]\n  (if (keyword? method)\n    (str/upper-case (name method))\n    method))\n\n(defn process-response [response interceptor]\n  (pr/-process-response interceptor response))\n\n(p/defn-curried js-handler [handler interceptors response]\n  (let [processed (reduce process-response response interceptors)]\n    ;;; This requires a bit of explanation: if we return a closeable,\n    ;;; it should be wrapping the original response, so we _don't_\n    ;;; close the original response stream\n    ;;; If you're writing a weird interceptor that doesn't do this,\n    ;;; remember to close the original stream yourself\n    #? (:clj (if (and response\n                      (instance? Closeable (second processed)))\n               (.close ^Closeable (pr/-body response))))\n    (handler processed)))\n\n(defn base-handler [interceptors {:keys [handler]}]\n  (if handler\n    (js-handler handler interceptors)\n    (u/throw-error \"No ajax handler provided.\")))\n\n(def default-interceptors (atom []))\n\n(defn normalize-request [request]\n  (let [response-format (i/get-response-format f/detect-response-format request)]\n    (-> request\n        (update :method normalize-method)\n        (update :interceptors\n                #(concat [response-format]\n                         (or % @default-interceptors)\n                         i/request-interceptors)))))\n\n(defn new-default-api []\n  #? (:clj  (a/new-api)\n      :cljs (new goog.net.XhrIo)))\n\n(defn process-request [request interceptor]\n  \"-process-request with the arguments flipped for use in reduce\"\n  (pr/-process-request interceptor request))\n\n(defn raw-ajax-request [{:keys [interceptors] :as request}]\n  \"The main request function.\"\n  (let [request (reduce process-request request interceptors)\n        ;;; Pass the request through the interceptors\n        handler (base-handler (reverse interceptors) request)\n        ;;; Set up a handler that passes it back through\n        api (or (:api request) (new-default-api))]\n    (pr/-js-ajax-request api request handler)))\n\n(defn ajax-request [request]\n  (-> request normalize-request raw-ajax-request))\n"]}